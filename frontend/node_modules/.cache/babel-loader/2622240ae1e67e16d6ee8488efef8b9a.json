{"ast":null,"code":"var _jsxFileName = \"/Users/vitaliidolzhenko/WebstormProjects/mesto-vetal/frontend/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from \"react\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Redirect, Route, Switch, withRouter } from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport fail from \"../images/info-tooltip-fail.svg\";\nimport successImg from \"../images/info-tooltip-success.svg\";\nimport * as auth from '../utils/auth.js'; // import {Cookies} from 'react-cookie'\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App(props) {\n  _s();\n\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [registered, setRegistered] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  const [email, setEmail] = React.useState({}); // Выход из системы\n\n  const onSignOut = () => {\n    auth.logout().then(res => {\n      if (res) {\n        setLoggedIn(false);\n      }\n    }).catch(err => console.log(`Error: ${err}`));\n  };\n\n  const handleRegister = (password, email) => {\n    auth.register(password, email).then(res => {\n      if (res.hasOwnProperty('error')) {\n        setRegistered(false);\n      } else {\n        setRegistered(true);\n        setEmail({\n          email: res.data.email\n        });\n      }\n\n      setIsInfoTooltipOpen(true);\n    }).catch(err => console.log(err));\n  };\n\n  const onLogin = (password, email) => {\n    auth.authorize(password, email).then(data => {\n      if (data) {\n        setEmail({\n          email: email\n        });\n        setLoggedIn(true);\n        props.history.push(\"/\");\n      } else {\n        setIsInfoTooltipOpen(true);\n      }\n    }).catch(err => {\n      setIsInfoTooltipOpen(true);\n      console.log(err);\n    });\n  };\n\n  const [currentUser, setCurrentUser] = React.useState({});\n  useEffect(() => {\n    if (!loggedIn) return;\n    api.getUserInfo().then(data => {\n      setCurrentUser(data);\n    }).catch(error => {\n      console.log(error);\n    });\n  }, [loggedIn]);\n  const [cards, setCards] = React.useState([]);\n  useEffect(() => {\n    if (!loggedIn) return;\n    api.getCardList().then(data => {\n      setCards(data);\n    }).catch(error => {\n      console.log(error);\n    });\n  }, [loggedIn]); // useEffect(() => {\n  //     if (loggedIn) {\n  //         auth.checkToken()\n  //             .then((res) => {\n  //                 if (res) {\n  //                     setEmail({email: res.data.email});\n  //                     setLoggedIn(true);\n  //                 }\n  //\n  //             })\n  //             .then(() => {\n  //                 props.history.push(\"/\");\n  //\n  //             })\n  //             .catch(error => {\n  //                 console.log(error);\n  //             });\n  //\n  //     }\n  // }, [props.history, loggedIn]);\n  // const onLogin = (password, email) => {\n  //     auth.authorize(password, email)\n  //         .then((data) => {\n  //             if (data && data.hasOwnProperty('token')) {\n  //                 // const cookies = new Cookies();\n  //                 // cookies.set('token', data.token);\n  //                 localStorage.setItem('token', data.token);\n  //                 setEmail({email: email});\n  //                 setLoggedIn(true);\n  //                 props.history.push(\"/\");\n  //             } else {\n  //                 setIsInfoTooltipOpen(true);\n  //             }\n  //         })\n  //         .catch(err => {\n  //             setIsInfoTooltipOpen(true);\n  //             console.log(err);\n  //         });\n  // };\n  // useEffect(() => {\n  //     // const cookies = new Cookies();\n  //     if (localStorage.getItem('token')) {\n  //         const jwt = localStorage.getItem('token');\n  //         // if (cookies.get('jwt')) {\n  //         //     const jwt = cookies.get('jwt');\n  //         // проверяем токен пользователя\n  //         auth.checkToken(jwt)\n  //             .then((res) => {\n  //                 if (res) {\n  //                     setEmail({email: res.data.email});\n  //                     setLoggedIn(true);\n  //                 }\n  //\n  //             })\n  //             .then(() => {\n  //                 props.history.push(\"/\");\n  //\n  //             })\n  //             .catch(error => {\n  //                 console.log(error);\n  //             });\n  //\n  //     }\n  // }, [props.history]);\n\n  const handleEditProfileClick = () => {\n    setIsEditProfilePopupOpen(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setIsAddPlacePopupOpen(true);\n  };\n\n  const handleEditAvatarClick = () => {\n    setIsEditAvatarPopupOpen(true);\n  };\n\n  const onInfoTooltipClose = () => {\n    closeAllPopups();\n\n    if (registered) {\n      setTimeout(() => props.history.push(\"/signin\"), 1000);\n    }\n  };\n\n  const closeAllPopups = () => {\n    setIsInfoTooltipOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsImagePopupOpen(false);\n  };\n\n  const handleCardClick = card => {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);\n  };\n\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n\n  const handleUpdateUser = currentUser => {\n    api.setUserInfo(currentUser.name, currentUser.about).then(data => {\n      setCurrentUser(data);\n      closeAllPopups();\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n\n  const handleUpdateAvatar = avatar => {\n    api.setUserAvatar(avatar).then(data => {\n      setCurrentUser(data);\n      closeAllPopups();\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id); // Отправляем запрос в API и получаем обновлённые данные карточки\n\n    api.changeLikeCardStatus(card._id, !isLiked).then(newCard => {\n      setCards(state => state.map(c => c._id === card._id ? newCard : c));\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id).then(_ => {\n      setCards(state => state.filter(c => c._id !== card._id));\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleAddPlace(e, card) {\n    api.addNewCard(card).then(card => {\n      setCards([card, ...cards]);\n      closeAllPopups();\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n      value: currentUser,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page\",\n        children: [/*#__PURE__*/_jsxDEV(Header, {\n          onSignOut: onSignOut,\n          userData: email\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Switch, {\n          children: [/*#__PURE__*/_jsxDEV(Route, {\n            path: \"/signin\",\n            children: [/*#__PURE__*/_jsxDEV(InfoTooltip, {\n              isOpen: isInfoTooltipOpen,\n              onClose: closeAllPopups,\n              image: fail,\n              title: 'Что-то пошло не так! Попробуйте ещё раз.'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 280,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Login, {\n              handleLogin: onLogin\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 287,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/signup\",\n            children: [/*#__PURE__*/_jsxDEV(InfoTooltip, {\n              isOpen: isInfoTooltipOpen,\n              onClose: onInfoTooltipClose,\n              image: registered ? successImg : fail,\n              title: registered ? 'Вы успешно зарегестрировались!' : 'Что-то пошло не так! Попробуйте ещё раз.'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Register, {\n              onRegister: handleRegister\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            children: [/*#__PURE__*/_jsxDEV(ProtectedRoute, {\n              exact: true,\n              path: \"/\",\n              loggedIn: loggedIn,\n              component: Main,\n              onEditProfile: handleEditProfileClick,\n              onAddPlace: handleAddPlaceClick,\n              onEditAvatar: handleEditAvatarClick,\n              cards: cards,\n              handleCardClick: handleCardClick,\n              setCards: setCards,\n              onCardLike: handleCardLike,\n              onCardDelete: handleCardDelete\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 29\n            }, this), loggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 42\n            }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/signin\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 65\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n          isOpen: isEditProfilePopupOpen,\n          onUpdateUser: handleUpdateUser,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n          isOpen: isAddPlacePopupOpen,\n          onAddPlaceSubmit: handleAddPlace,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n          isOpen: isEditAvatarPopupOpen,\n          onUpdateAvatar: handleUpdateAvatar,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(PopupWithForm, {\n          name: \"delete-image\",\n          title: \"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",\n          buttonName: \"\\u0414\\u0430\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n          card: selectedCard,\n          onClose: closeAllPopups,\n          isOpen: isImagePopupOpen\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 273,\n    columnNumber: 9\n  }, this);\n}\n\n_s(App, \"LP3HE//tiHL5YxwRhWGFQKFOigg=\");\n\n_c = App;\nexport default _c2 = withRouter(App);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"App\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/vitaliidolzhenko/WebstormProjects/mesto-vetal/frontend/src/components/App.js"],"names":["React","useEffect","Header","Main","Footer","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Redirect","Route","Switch","withRouter","Login","Register","InfoTooltip","ProtectedRoute","auth","App","props","loggedIn","setLoggedIn","useState","registered","setRegistered","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","email","setEmail","onSignOut","logout","then","res","catch","err","console","log","handleRegister","password","register","hasOwnProperty","data","onLogin","authorize","history","push","currentUser","setCurrentUser","getUserInfo","error","cards","setCards","getCardList","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","onInfoTooltipClose","closeAllPopups","setTimeout","setIsImagePopupOpen","handleCardClick","card","setSelectedCard","selectedCard","isImagePopupOpen","handleUpdateUser","setUserInfo","name","about","handleUpdateAvatar","avatar","setUserAvatar","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","deleteCard","_","filter","handleAddPlace","e","addNewCard","fail","successImg"],"mappings":"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","sourcesContent":["import React, {useEffect} from \"react\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/api\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport {Redirect, Route, Switch, withRouter} from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport fail from '../images/info-tooltip-fail.svg';\nimport successImg from '../images/info-tooltip-success.svg';\nimport * as auth from '../utils/auth.js';\n\n// import {Cookies} from 'react-cookie'\n\n\nfunction App(props) {\n    const [loggedIn, setLoggedIn] = React.useState(false);\n    const [registered, setRegistered] = React.useState(false);\n\n    const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n    const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n    const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n\n    const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n    const [email, setEmail] = React.useState({});\n\n    // Выход из системы\n    const onSignOut = () => {\n        auth.logout()\n            .then((res) => {\n                if (res) {\n                    setLoggedIn(false);\n                }\n            })\n            .catch((err) => console.log(`Error: ${err}`));\n    };\n\n\n\n    const handleRegister = (password, email) => {\n\n        auth.register(password, email)\n            .then((res) => {\n                if (res.hasOwnProperty('error')) {\n                    setRegistered(false);\n                } else {\n                    setRegistered(true);\n                    setEmail({email: res.data.email});\n                }\n                setIsInfoTooltipOpen(true);\n            })\n            .catch((err) => console.log(err));\n    };\n\n    const onLogin = (password, email) => {\n        auth.authorize(password, email)\n            .then((data) => {\n                if (data) {\n                    setEmail({email: email});\n                    setLoggedIn(true);\n                    props.history.push(\"/\");\n                } else {\n                    setIsInfoTooltipOpen(true);\n                }\n            })\n            .catch(err => {\n                setIsInfoTooltipOpen(true);\n                console.log(err);\n            });\n    };\n\n    const [currentUser, setCurrentUser] = React.useState({});\n\n    useEffect(() => {\n        if (!loggedIn) return;\n            api.getUserInfo()\n                .then(data => {\n                    setCurrentUser(data);\n                })\n                .catch(error => {\n                    console.log(error);\n                });\n        }, [loggedIn]);\n\n    const [cards, setCards] = React.useState([]);\n\n    useEffect(() => {\n        if (!loggedIn) return;\n            api.getCardList()\n                .then(data => {\n                    setCards(data);\n                })\n                .catch(error => {\n                    console.log(error);\n                });\n        }, [loggedIn]);\n\n    // useEffect(() => {\n    //     if (loggedIn) {\n    //         auth.checkToken()\n    //             .then((res) => {\n    //                 if (res) {\n    //                     setEmail({email: res.data.email});\n    //                     setLoggedIn(true);\n    //                 }\n    //\n    //             })\n    //             .then(() => {\n    //                 props.history.push(\"/\");\n    //\n    //             })\n    //             .catch(error => {\n    //                 console.log(error);\n    //             });\n    //\n    //     }\n    // }, [props.history, loggedIn]);\n\n\n    // const onLogin = (password, email) => {\n    //     auth.authorize(password, email)\n    //         .then((data) => {\n    //             if (data && data.hasOwnProperty('token')) {\n    //                 // const cookies = new Cookies();\n    //                 // cookies.set('token', data.token);\n    //                 localStorage.setItem('token', data.token);\n    //                 setEmail({email: email});\n    //                 setLoggedIn(true);\n    //                 props.history.push(\"/\");\n    //             } else {\n    //                 setIsInfoTooltipOpen(true);\n    //             }\n    //         })\n    //         .catch(err => {\n    //             setIsInfoTooltipOpen(true);\n    //             console.log(err);\n    //         });\n    // };\n\n\n    // useEffect(() => {\n    //     // const cookies = new Cookies();\n    //     if (localStorage.getItem('token')) {\n    //         const jwt = localStorage.getItem('token');\n    //         // if (cookies.get('jwt')) {\n    //         //     const jwt = cookies.get('jwt');\n    //         // проверяем токен пользователя\n    //         auth.checkToken(jwt)\n    //             .then((res) => {\n    //                 if (res) {\n    //                     setEmail({email: res.data.email});\n    //                     setLoggedIn(true);\n    //                 }\n    //\n    //             })\n    //             .then(() => {\n    //                 props.history.push(\"/\");\n    //\n    //             })\n    //             .catch(error => {\n    //                 console.log(error);\n    //             });\n    //\n    //     }\n    // }, [props.history]);\n\n\n    const handleEditProfileClick = () => {\n        setIsEditProfilePopupOpen(true);\n    };\n    const handleAddPlaceClick = () => {\n        setIsAddPlacePopupOpen(true);\n    };\n\n    const handleEditAvatarClick = () => {\n        setIsEditAvatarPopupOpen(true);\n    };\n\n\n    const onInfoTooltipClose = () => {\n        closeAllPopups();\n        if (registered) {\n            setTimeout(() => props.history.push(\"/signin\"), 1000);\n        }\n\n    };\n\n    const closeAllPopups = () => {\n        setIsInfoTooltipOpen(false);\n        setIsEditProfilePopupOpen(false);\n        setIsAddPlacePopupOpen(false);\n        setIsEditAvatarPopupOpen(false);\n        setIsImagePopupOpen(false);\n    };\n\n    const handleCardClick = (card) => {\n        setSelectedCard(card);\n        setIsImagePopupOpen(true);\n    };\n\n\n\n    const [selectedCard, setSelectedCard] = React.useState({});\n    const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n\n    const handleUpdateUser = (currentUser) => {\n        api.setUserInfo(currentUser.name, currentUser.about)\n            .then(data => {\n                setCurrentUser(data);\n                closeAllPopups();\n\n            })\n            .catch(error => {\n                console.log(error);\n            });\n\n    };\n\n    const handleUpdateAvatar = (avatar) => {\n        api.setUserAvatar(avatar)\n            .then(data => {\n                setCurrentUser(data);\n                closeAllPopups();\n            })\n            .catch(error => {\n                console.log(error);\n            });\n\n    };\n\n    function handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api.changeLikeCardStatus(card._id, !isLiked)\n            .then((newCard) => {\n                setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    function handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(_ => {\n                setCards((state) => state.filter((c) => c._id !== card._id));\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    function handleAddPlace(e, card) {\n        api.addNewCard(card)\n            .then(card => {\n                setCards([card, ...cards]);\n                closeAllPopups();\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    return (\n        <div className=\"App\">\n            <CurrentUserContext.Provider value={currentUser}>\n                <div className=\"page\">\n                    <Header onSignOut={onSignOut} userData={email}/>\n                    <Switch>\n                        <Route path=\"/signin\">\n\n                            <InfoTooltip\n                                isOpen={isInfoTooltipOpen}\n                                onClose={closeAllPopups}\n                                image={fail}\n                                title={'Что-то пошло не так! Попробуйте ещё раз.'}\n\n                            />\n                            <Login handleLogin={onLogin}/>\n                        </Route>\n                        <Route path=\"/signup\">\n\n                            <InfoTooltip\n                                isOpen={isInfoTooltipOpen}\n                                onClose={onInfoTooltipClose}\n                                image={registered ? successImg : fail}\n                                title={registered ? 'Вы успешно зарегестрировались!' : 'Что-то пошло не так! Попробуйте ещё раз.'}\n\n                            />\n                            <Register\n                                onRegister={handleRegister}/>\n\n                        </Route>\n\n                        <Route>\n\n\n                            <ProtectedRoute exact path=\"/\"\n                                            loggedIn={loggedIn}\n                                            component={Main}\n                                            onEditProfile={handleEditProfileClick}\n                                            onAddPlace={handleAddPlaceClick}\n                                            onEditAvatar={handleEditAvatarClick}\n                                            cards={cards}\n                                            handleCardClick={handleCardClick}\n                                            setCards={setCards}\n                                            onCardLike={handleCardLike}\n                                            onCardDelete={handleCardDelete}\n\n                            />\n                            {loggedIn ? (<Redirect to=\"/\"/>) : (<Redirect to=\"/signin\"/>)}\n                        </Route>\n\n\n                    </Switch>\n                    <Footer/>\n\n                    <EditProfilePopup isOpen={isEditProfilePopupOpen}\n                                      onUpdateUser={handleUpdateUser}\n                                      onClose={closeAllPopups}/>\n\n                    <AddPlacePopup isOpen={isAddPlacePopupOpen}\n                                   onAddPlaceSubmit={handleAddPlace}\n                                   onClose={closeAllPopups}/>\n\n                    <EditAvatarPopup isOpen={isEditAvatarPopupOpen}\n                                     onUpdateAvatar={handleUpdateAvatar}\n                                     onClose={closeAllPopups}/>\n\n                    <PopupWithForm name=\"delete-image\" title=\"Вы уверены?\" buttonName=\"Да\"/>\n\n                    <ImagePopup\n                        card={selectedCard}\n                        onClose={closeAllPopups}\n                        isOpen={isImagePopupOpen}\n                    />\n                </div>\n            </CurrentUserContext.Provider>\n        </div>\n    );\n}\n\n\nexport default withRouter(App);\n\n"]},"metadata":{},"sourceType":"module"}