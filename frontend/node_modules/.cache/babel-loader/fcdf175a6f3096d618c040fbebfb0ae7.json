{"ast":null,"code":"import _toConsumableArray from\"/Users/vitaliidolzhenko/WebstormProjects/mesto-vetal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/vitaliidolzhenko/WebstormProjects/mesto-vetal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect}from\"react\";import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import api from\"../utils/api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import{Redirect,Route,Switch,withRouter}from\"react-router-dom\";import Login from\"./Login\";import Register from\"./Register\";import InfoTooltip from\"./InfoTooltip\";import ProtectedRoute from\"./ProtectedRoute\";import fail from\"../images/info-tooltip-fail.svg\";import successImg from\"../images/info-tooltip-success.svg\";import*as auth from'../utils/auth.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(props){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loggedIn=_React$useState2[0],setLoggedIn=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),registered=_React$useState4[0],setRegistered=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditProfilePopupOpen=_React$useState6[0],setIsEditProfilePopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isAddPlacePopupOpen=_React$useState8[0],setIsAddPlacePopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isEditAvatarPopupOpen=_React$useState10[0],setIsEditAvatarPopupOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isInfoTooltipOpen=_React$useState12[0],setIsInfoTooltipOpen=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),email=_React$useState14[0],setEmail=_React$useState14[1];var onSignOut=function onSignOut(){localStorage.removeItem('token');setRegistered(false);};var onLogin=function onLogin(password,email){auth.authorize(password,email).then(function(data){if(data&&data.hasOwnProperty('token')){localStorage.setItem('token',data.token);setEmail({email:email});setLoggedIn(true);props.history.push(\"/\");}else{setIsInfoTooltipOpen(true);}}).catch(function(err){setIsInfoTooltipOpen(true);console.log(err);});};useEffect(function(){if(localStorage.getItem('token')){var jwt=localStorage.getItem('token');// проверяем токен пользователя\nauth.checkToken(jwt).then(function(res){if(res){setEmail({email:res.data.email});setLoggedIn(true);}}).then(function(){props.history.push(\"/\");}).catch(function(error){console.log(error);});}},[props.history]);var handleEditProfileClick=function handleEditProfileClick(){setIsEditProfilePopupOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);};var handleEditAvatarClick=function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);};var onInfoTooltipClose=function onInfoTooltipClose(){closeAllPopups();if(registered){setTimeout(function(){return props.history.push(\"/signin\");},1000);}};var closeAllPopups=function closeAllPopups(){setIsInfoTooltipOpen(false);setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsImagePopupOpen(false);};var handleCardClick=function handleCardClick(card){setSelectedCard(card);setIsImagePopupOpen(true);};var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),cards=_React$useState16[0],setCards=_React$useState16[1];var _React$useState17=React.useState({}),_React$useState18=_slicedToArray(_React$useState17,2),selectedCard=_React$useState18[0],setSelectedCard=_React$useState18[1];var _React$useState19=React.useState(false),_React$useState20=_slicedToArray(_React$useState19,2),isImagePopupOpen=_React$useState20[0],setIsImagePopupOpen=_React$useState20[1];useEffect(function(){api.getCardList().then(function(data){setCards(data);}).catch(function(error){console.log(error);});},[]);var _React$useState21=React.useState({}),_React$useState22=_slicedToArray(_React$useState21,2),currentUser=_React$useState22[0],setCurrentUser=_React$useState22[1];useEffect(function(){api.getUserInfo().then(function(data){setCurrentUser(data);}).catch(function(error){console.log(error);});},[]);var handleRegister=function handleRegister(password,email){auth.register(password,email).then(function(res){if(res.hasOwnProperty('error')){setRegistered(false);}else{setRegistered(true);}setIsInfoTooltipOpen(true);}).catch(function(err){return console.log(err);});};var handleUpdateUser=function handleUpdateUser(currentUser){api.setUserInfo(currentUser.name,currentUser.about).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(error){console.log(error);});};var handleUpdateAvatar=function handleUpdateAvatar(avatar){api.setUserAvatar(avatar).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(error){console.log(error);});};function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(error){console.log(error);});}function handleCardDelete(card){api.deleteCard(card._id).then(function(_){setCards(function(state){return state.filter(function(c){return c._id!==card._id;});});}).catch(function(error){console.log(error);});}function handleAddPlace(e,card){api.addNewCard(card).then(function(card){setCards([card].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(error){console.log(error);});}return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{onSignOut:onSignOut,userData:email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(Route,{path:\"/signin\",children:[/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups,image:fail,title:'Что-то пошло не так! Попробуйте ещё раз.'}),/*#__PURE__*/_jsx(Login,{handleLogin:onLogin})]}),/*#__PURE__*/_jsxs(Route,{path:\"/signup\",children:[/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:onInfoTooltipClose,image:registered?successImg:fail,title:registered?'Вы успешно зарегестрировались!':'Что-то пошло не так! Попробуйте ещё раз.'}),/*#__PURE__*/_jsx(Register,{onRegister:handleRegister})]}),/*#__PURE__*/_jsxs(Route,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,cards:cards,handleCardClick:handleCardClick,setCards:setCards,onCardLike:handleCardLike,onCardDelete:handleCardDelete}),loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})]})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onUpdateUser:handleUpdateUser,onClose:closeAllPopups}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onAddPlaceSubmit:handleAddPlace,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onUpdateAvatar:handleUpdateAvatar,onClose:closeAllPopups}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"delete-image\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",buttonName:\"\\u0414\\u0430\"}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups,isOpen:isImagePopupOpen})]})})});}export default withRouter(App);","map":{"version":3,"sources":["/Users/vitaliidolzhenko/WebstormProjects/mesto-vetal/frontend/src/components/App.js"],"names":["React","useEffect","Header","Main","Footer","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Redirect","Route","Switch","withRouter","Login","Register","InfoTooltip","ProtectedRoute","auth","App","props","useState","loggedIn","setLoggedIn","registered","setRegistered","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","email","setEmail","onSignOut","localStorage","removeItem","onLogin","password","authorize","then","data","hasOwnProperty","setItem","token","history","push","catch","err","console","log","getItem","jwt","checkToken","res","error","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","onInfoTooltipClose","closeAllPopups","setTimeout","setIsImagePopupOpen","handleCardClick","card","setSelectedCard","cards","setCards","selectedCard","isImagePopupOpen","getCardList","currentUser","setCurrentUser","getUserInfo","handleRegister","register","handleUpdateUser","setUserInfo","name","about","handleUpdateAvatar","avatar","setUserAvatar","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","deleteCard","_","filter","handleAddPlace","e","addNewCard","fail","successImg"],"mappings":"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","sourcesContent":["import React, {useEffect} from \"react\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/api\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport {Redirect, Route, Switch, withRouter} from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport fail from '../images/info-tooltip-fail.svg';\nimport successImg from '../images/info-tooltip-success.svg';\nimport * as auth from '../utils/auth.js';\n\n\nfunction App(props) {\n    const [loggedIn, setLoggedIn] = React.useState(false);\n    const [registered, setRegistered] = React.useState(false);\n\n    const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n    const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n    const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n\n    const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n    const [email, setEmail] = React.useState({});\n\n    const onSignOut = () => {\n        localStorage.removeItem('token');\n        setRegistered(false);\n    };\n\n    const onLogin = (password, email) => {\n        auth.authorize(password, email)\n            .then((data) => {\n                if (data && data.hasOwnProperty('token')) {\n                    localStorage.setItem('token', data.token);\n                    setEmail({email: email});\n                    setLoggedIn(true);\n                    props.history.push(\"/\");\n                } else {\n                    setIsInfoTooltipOpen(true);\n                }\n            })\n            .catch(err => {\n                setIsInfoTooltipOpen(true);\n                console.log(err);\n            });\n    };\n\n\n    useEffect(() => {\n        if (localStorage.getItem('token')) {\n            const jwt = localStorage.getItem('token');\n            // проверяем токен пользователя\n            auth.checkToken(jwt)\n                .then((res) => {\n                    if (res) {\n                        setEmail({email: res.data.email});\n                        setLoggedIn(true);\n                    }\n\n                })\n                .then(() => {\n                    props.history.push(\"/\");\n\n                })\n                .catch(error => {\n                    console.log(error);\n                });\n\n        }\n    }, [props.history]);\n\n\n\n\n    const handleEditProfileClick = () => {\n        setIsEditProfilePopupOpen(true);\n    };\n    const handleAddPlaceClick = () => {\n        setIsAddPlacePopupOpen(true);\n    };\n\n    const handleEditAvatarClick = () => {\n        setIsEditAvatarPopupOpen(true);\n    };\n\n\n    const onInfoTooltipClose = () => {\n        closeAllPopups();\n        if (registered) {\n            setTimeout(() => props.history.push(\"/signin\"), 1000);\n        }\n\n    };\n\n    const closeAllPopups = () => {\n        setIsInfoTooltipOpen(false);\n        setIsEditProfilePopupOpen(false);\n        setIsAddPlacePopupOpen(false);\n        setIsEditAvatarPopupOpen(false);\n        setIsImagePopupOpen(false);\n    };\n\n    const handleCardClick = (card) => {\n        setSelectedCard(card);\n        setIsImagePopupOpen(true);\n    };\n\n\n    const [cards, setCards] = React.useState([]);\n    const [selectedCard, setSelectedCard] = React.useState({});\n    const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n\n    useEffect(() => {\n        api.getCardList()\n            .then(data => {\n                setCards(data);\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }, []);\n\n    const [currentUser, setCurrentUser] = React.useState({});\n\n    useEffect(() => {\n        api.getUserInfo()\n            .then(data => {\n                setCurrentUser(data);\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }, []);\n\n    const handleRegister = (password, email) => {\n\n        auth.register(password, email)\n            .then((res) => {\n                if (res.hasOwnProperty('error')) {\n                    setRegistered(false);\n                } else {\n                    setRegistered(true);\n                }\n                setIsInfoTooltipOpen(true);\n            })\n            .catch((err) => console.log(err));\n    };\n\n    const handleUpdateUser = (currentUser) => {\n        api.setUserInfo(currentUser.name, currentUser.about)\n            .then(data => {\n                setCurrentUser(data);\n                closeAllPopups();\n\n            })\n            .catch(error => {\n                console.log(error);\n            });\n\n    };\n\n    const handleUpdateAvatar = (avatar) => {\n        api.setUserAvatar(avatar)\n            .then(data => {\n                setCurrentUser(data);\n                closeAllPopups();\n            })\n            .catch(error => {\n                console.log(error);\n            });\n\n    };\n\n    function handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api.changeLikeCardStatus(card._id, !isLiked)\n            .then((newCard) => {\n                setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    function handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(_ => {\n                setCards((state) => state.filter((c) => c._id !== card._id));\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    function handleAddPlace(e, card) {\n        api.addNewCard(card)\n            .then(card => {\n                setCards([card, ...cards]);\n                closeAllPopups();\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    return (\n        <div className=\"App\">\n            <CurrentUserContext.Provider value={currentUser}>\n                <div className=\"page\">\n                    <Header onSignOut={onSignOut} userData={email}/>\n                    <Switch>\n                        <Route path=\"/signin\">\n\n                            <InfoTooltip\n                                isOpen={isInfoTooltipOpen}\n                                onClose={closeAllPopups}\n                                image={fail}\n                                title={'Что-то пошло не так! Попробуйте ещё раз.'}\n\n                            />\n                            <Login handleLogin={onLogin}/>\n                        </Route>\n                        <Route path=\"/signup\">\n\n                            <InfoTooltip\n                                isOpen={isInfoTooltipOpen}\n                                onClose={onInfoTooltipClose}\n                                image={registered ? successImg : fail}\n                                title={registered ? 'Вы успешно зарегестрировались!' : 'Что-то пошло не так! Попробуйте ещё раз.'}\n\n                            />\n                            <Register\n                                onRegister={handleRegister}/>\n\n                        </Route>\n\n                        <Route>\n\n\n                            <ProtectedRoute exact path=\"/\"\n                                            loggedIn={loggedIn}\n                                            component={Main}\n                                            onEditProfile={handleEditProfileClick}\n                                            onAddPlace={handleAddPlaceClick}\n                                            onEditAvatar={handleEditAvatarClick}\n                                            cards={cards}\n                                            handleCardClick={handleCardClick}\n                                            setCards={setCards}\n                                            onCardLike={handleCardLike}\n                                            onCardDelete={handleCardDelete}\n\n                            />\n                            {loggedIn ? (<Redirect to=\"/\"/>) : (<Redirect to=\"/signin\"/>)}\n                        </Route>\n\n\n                    </Switch>\n                    <Footer/>\n\n                    <EditProfilePopup isOpen={isEditProfilePopupOpen}\n                                      onUpdateUser={handleUpdateUser}\n                                      onClose={closeAllPopups}/>\n\n                    <AddPlacePopup isOpen={isAddPlacePopupOpen}\n                                   onAddPlaceSubmit={handleAddPlace}\n                                   onClose={closeAllPopups}/>\n\n                    <EditAvatarPopup isOpen={isEditAvatarPopupOpen}\n                                     onUpdateAvatar={handleUpdateAvatar}\n                                     onClose={closeAllPopups}/>\n\n                    <PopupWithForm name=\"delete-image\" title=\"Вы уверены?\" buttonName=\"Да\"/>\n\n                    <ImagePopup\n                        card={selectedCard}\n                        onClose={closeAllPopups}\n                        isOpen={isImagePopupOpen}\n                    />\n                </div>\n            </CurrentUserContext.Provider>\n        </div>\n    );\n}\n\n\nexport default withRouter(App);\n\n"]},"metadata":{},"sourceType":"module"}