{"ast":null,"code":"var _jsxFileName = \"/Users/vitaliidolzhenko/WebstormProjects/mesto-vetal/frontend/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from \"react\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport { Redirect, Route, Switch, withRouter } from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport fail from \"../images/info-tooltip-fail.svg\";\nimport successImg from \"../images/info-tooltip-success.svg\";\nimport * as auth from '../utils/auth.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App(props) {\n  _s();\n\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [registered, setRegistered] = React.useState(false);\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  const [email, setEmail] = React.useState({});\n\n  const onSignOut = () => {\n    localStorage.removeItem('token');\n    setRegistered(false);\n  };\n\n  const onLogin = (password, email) => {\n    auth.authorize(password, email).then(data => {\n      if (data && data.hasOwnProperty('token')) {\n        localStorage.setItem('token', data.token);\n        setEmail({\n          email: email\n        });\n        setLoggedIn(true);\n        props.history.push(\"/\");\n      } else {\n        setIsInfoTooltipOpen(true);\n      }\n    }).catch(err => {\n      setIsInfoTooltipOpen(true);\n      console.log(err);\n    });\n  };\n\n  useEffect(() => {\n    if (localStorage.getItem('token')) {\n      const jwt = localStorage.getItem('token'); // проверяем токен пользователя\n\n      auth.checkToken(jwt).then(res => {\n        if (res) {\n          setEmail({\n            email: res.data.email\n          });\n          setLoggedIn(true);\n        }\n      }).then(() => {\n        props.history.push(\"/\");\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n  }, [props.history]);\n\n  const handleEditProfileClick = () => {\n    setIsEditProfilePopupOpen(true);\n  };\n\n  const handleAddPlaceClick = () => {\n    setIsAddPlacePopupOpen(true);\n  };\n\n  const handleEditAvatarClick = () => {\n    setIsEditAvatarPopupOpen(true);\n  };\n\n  const onInfoTooltipClose = () => {\n    closeAllPopups();\n\n    if (registered) {\n      setTimeout(() => props.history.push(\"/signin\"), 1000);\n    }\n  };\n\n  const closeAllPopups = () => {\n    setIsInfoTooltipOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsImagePopupOpen(false);\n  };\n\n  const handleCardClick = card => {\n    setSelectedCard(card);\n    setIsImagePopupOpen(true);\n  };\n\n  const [cards, setCards] = React.useState([]);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n  useEffect(() => {\n    api.getCardList().then(data => {\n      setCards(data);\n    }).catch(error => {\n      console.log(error);\n    });\n  }, []);\n  const [currentUser, setCurrentUser] = React.useState({});\n  useEffect(() => {\n    api.getUserInfo().then(data => {\n      setCurrentUser(data);\n    }).catch(error => {\n      console.log(error);\n    });\n  }, []);\n\n  const handleRegister = (password, email) => {\n    auth.register(password, email).then(res => {\n      if (res.hasOwnProperty('error')) {\n        setRegistered(false);\n      } else {\n        setRegistered(true);\n      }\n\n      setIsInfoTooltipOpen(true);\n    }).catch(err => console.log(err));\n  };\n\n  const handleUpdateUser = currentUser => {\n    api.setUserInfo(currentUser.name, currentUser.about).then(data => {\n      setCurrentUser(data);\n      closeAllPopups();\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n\n  const handleUpdateAvatar = avatar => {\n    api.setUserAvatar(avatar).then(data => {\n      setCurrentUser(data);\n      closeAllPopups();\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id); // Отправляем запрос в API и получаем обновлённые данные карточки\n\n    api.changeLikeCardStatus(card._id, !isLiked).then(newCard => {\n      setCards(state => state.map(c => c._id === card._id ? newCard : c));\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleCardDelete(card) {\n    api.deleteCard(card._id).then(_ => {\n      setCards(state => state.filter(c => c._id !== card._id));\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  function handleAddPlace(e, card) {\n    api.addNewCard(card).then(card => {\n      setCards([card, ...cards]);\n      closeAllPopups();\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n      value: currentUser,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"page\",\n        children: [/*#__PURE__*/_jsxDEV(Header, {\n          onSignOut: onSignOut,\n          userData: email\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Switch, {\n          children: [/*#__PURE__*/_jsxDEV(Route, {\n            path: \"/signin\",\n            children: [/*#__PURE__*/_jsxDEV(InfoTooltip, {\n              isOpen: isInfoTooltipOpen,\n              onClose: closeAllPopups,\n              image: fail,\n              title: 'Что-то пошло не так! Попробуйте ещё раз.'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Login, {\n              handleLogin: onLogin\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 230,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/signup\",\n            children: [/*#__PURE__*/_jsxDEV(InfoTooltip, {\n              isOpen: isInfoTooltipOpen,\n              onClose: onInfoTooltipClose,\n              image: registered ? successImg : fail,\n              title: registered ? 'Вы успешно зарегестрировались!' : 'Что-то пошло не так! Попробуйте ещё раз.'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Register, {\n              onRegister: handleRegister\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            children: [/*#__PURE__*/_jsxDEV(ProtectedRoute, {\n              exact: true,\n              path: \"/\",\n              loggedIn: loggedIn,\n              component: Main,\n              onEditProfile: handleEditProfileClick,\n              onAddPlace: handleAddPlaceClick,\n              onEditAvatar: handleEditAvatarClick,\n              cards: cards,\n              handleCardClick: handleCardClick,\n              setCards: setCards,\n              onCardLike: handleCardLike,\n              onCardDelete: handleCardDelete\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 29\n            }, this), loggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 42\n            }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/signin\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 65\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n          isOpen: isEditProfilePopupOpen,\n          onUpdateUser: handleUpdateUser,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n          isOpen: isAddPlacePopupOpen,\n          onAddPlaceSubmit: handleAddPlace,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n          isOpen: isEditAvatarPopupOpen,\n          onUpdateAvatar: handleUpdateAvatar,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(PopupWithForm, {\n          name: \"delete-image\",\n          title: \"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",\n          buttonName: \"\\u0414\\u0430\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n          card: selectedCard,\n          onClose: closeAllPopups,\n          isOpen: isImagePopupOpen\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 216,\n    columnNumber: 9\n  }, this);\n}\n\n_s(App, \"31Jr3z1JdMBbOoeCbsFokegfm7s=\");\n\n_c = App;\nexport default _c2 = withRouter(App);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"App\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/vitaliidolzhenko/WebstormProjects/mesto-vetal/frontend/src/components/App.js"],"names":["React","useEffect","Header","Main","Footer","PopupWithForm","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Redirect","Route","Switch","withRouter","Login","Register","InfoTooltip","ProtectedRoute","auth","App","props","loggedIn","setLoggedIn","useState","registered","setRegistered","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isInfoTooltipOpen","setIsInfoTooltipOpen","email","setEmail","onSignOut","localStorage","removeItem","onLogin","password","authorize","then","data","hasOwnProperty","setItem","token","history","push","catch","err","console","log","getItem","jwt","checkToken","res","error","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","onInfoTooltipClose","closeAllPopups","setTimeout","setIsImagePopupOpen","handleCardClick","card","setSelectedCard","cards","setCards","selectedCard","isImagePopupOpen","getCardList","currentUser","setCurrentUser","getUserInfo","handleRegister","register","handleUpdateUser","setUserInfo","name","about","handleUpdateAvatar","avatar","setUserAvatar","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","state","map","c","handleCardDelete","deleteCard","_","filter","handleAddPlace","e","addNewCard","fail","successImg"],"mappings":"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","sourcesContent":["import React, {useEffect} from \"react\";\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/api\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport {Redirect, Route, Switch, withRouter} from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport fail from '../images/info-tooltip-fail.svg';\nimport successImg from '../images/info-tooltip-success.svg';\nimport * as auth from '../utils/auth.js';\n\n\nfunction App(props) {\n    const [loggedIn, setLoggedIn] = React.useState(false);\n    const [registered, setRegistered] = React.useState(false);\n\n    const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n    const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n    const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n\n    const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n    const [email, setEmail] = React.useState({});\n\n    const onSignOut = () => {\n        localStorage.removeItem('token');\n        setRegistered(false);\n    };\n\n    const onLogin = (password, email) => {\n        auth.authorize(password, email)\n            .then((data) => {\n                if (data && data.hasOwnProperty('token')) {\n                    localStorage.setItem('token', data.token);\n                    setEmail({email: email});\n                    setLoggedIn(true);\n                    props.history.push(\"/\");\n                } else {\n                    setIsInfoTooltipOpen(true);\n                }\n            })\n            .catch(err => {\n                setIsInfoTooltipOpen(true);\n                console.log(err);\n            });\n    };\n\n\n    useEffect(() => {\n        if (localStorage.getItem('token')) {\n            const jwt = localStorage.getItem('token');\n            // проверяем токен пользователя\n            auth.checkToken(jwt)\n                .then((res) => {\n                    if (res) {\n                        setEmail({email: res.data.email});\n                        setLoggedIn(true);\n                    }\n\n                })\n                .then(() => {\n                    props.history.push(\"/\");\n\n                })\n                .catch(error => {\n                    console.log(error);\n                });\n\n        }\n    }, [props.history]);\n\n\n\n\n    const handleEditProfileClick = () => {\n        setIsEditProfilePopupOpen(true);\n    };\n    const handleAddPlaceClick = () => {\n        setIsAddPlacePopupOpen(true);\n    };\n\n    const handleEditAvatarClick = () => {\n        setIsEditAvatarPopupOpen(true);\n    };\n\n\n    const onInfoTooltipClose = () => {\n        closeAllPopups();\n        if (registered) {\n            setTimeout(() => props.history.push(\"/signin\"), 1000);\n        }\n\n    };\n\n    const closeAllPopups = () => {\n        setIsInfoTooltipOpen(false);\n        setIsEditProfilePopupOpen(false);\n        setIsAddPlacePopupOpen(false);\n        setIsEditAvatarPopupOpen(false);\n        setIsImagePopupOpen(false);\n    };\n\n    const handleCardClick = (card) => {\n        setSelectedCard(card);\n        setIsImagePopupOpen(true);\n    };\n\n\n    const [cards, setCards] = React.useState([]);\n    const [selectedCard, setSelectedCard] = React.useState({});\n    const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n\n    useEffect(() => {\n        api.getCardList()\n            .then(data => {\n                setCards(data);\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }, []);\n\n    const [currentUser, setCurrentUser] = React.useState({});\n\n    useEffect(() => {\n        api.getUserInfo()\n            .then(data => {\n                setCurrentUser(data);\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }, []);\n\n    const handleRegister = (password, email) => {\n\n        auth.register(password, email)\n            .then((res) => {\n                if (res.hasOwnProperty('error')) {\n                    setRegistered(false);\n                } else {\n                    setRegistered(true);\n                }\n                setIsInfoTooltipOpen(true);\n            })\n            .catch((err) => console.log(err));\n    };\n\n    const handleUpdateUser = (currentUser) => {\n        api.setUserInfo(currentUser.name, currentUser.about)\n            .then(data => {\n                setCurrentUser(data);\n                closeAllPopups();\n\n            })\n            .catch(error => {\n                console.log(error);\n            });\n\n    };\n\n    const handleUpdateAvatar = (avatar) => {\n        api.setUserAvatar(avatar)\n            .then(data => {\n                setCurrentUser(data);\n                closeAllPopups();\n            })\n            .catch(error => {\n                console.log(error);\n            });\n\n    };\n\n    function handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api.changeLikeCardStatus(card._id, !isLiked)\n            .then((newCard) => {\n                setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    function handleCardDelete(card) {\n        api.deleteCard(card._id)\n            .then(_ => {\n                setCards((state) => state.filter((c) => c._id !== card._id));\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    function handleAddPlace(e, card) {\n        api.addNewCard(card)\n            .then(card => {\n                setCards([card, ...cards]);\n                closeAllPopups();\n            })\n            .catch(error => {\n                console.log(error);\n            });\n    }\n\n    return (\n        <div className=\"App\">\n            <CurrentUserContext.Provider value={currentUser}>\n                <div className=\"page\">\n                    <Header onSignOut={onSignOut} userData={email}/>\n                    <Switch>\n                        <Route path=\"/signin\">\n\n                            <InfoTooltip\n                                isOpen={isInfoTooltipOpen}\n                                onClose={closeAllPopups}\n                                image={fail}\n                                title={'Что-то пошло не так! Попробуйте ещё раз.'}\n\n                            />\n                            <Login handleLogin={onLogin}/>\n                        </Route>\n                        <Route path=\"/signup\">\n\n                            <InfoTooltip\n                                isOpen={isInfoTooltipOpen}\n                                onClose={onInfoTooltipClose}\n                                image={registered ? successImg : fail}\n                                title={registered ? 'Вы успешно зарегестрировались!' : 'Что-то пошло не так! Попробуйте ещё раз.'}\n\n                            />\n                            <Register\n                                onRegister={handleRegister}/>\n\n                        </Route>\n\n                        <Route>\n\n\n                            <ProtectedRoute exact path=\"/\"\n                                            loggedIn={loggedIn}\n                                            component={Main}\n                                            onEditProfile={handleEditProfileClick}\n                                            onAddPlace={handleAddPlaceClick}\n                                            onEditAvatar={handleEditAvatarClick}\n                                            cards={cards}\n                                            handleCardClick={handleCardClick}\n                                            setCards={setCards}\n                                            onCardLike={handleCardLike}\n                                            onCardDelete={handleCardDelete}\n\n                            />\n                            {loggedIn ? (<Redirect to=\"/\"/>) : (<Redirect to=\"/signin\"/>)}\n                        </Route>\n\n\n                    </Switch>\n                    <Footer/>\n\n                    <EditProfilePopup isOpen={isEditProfilePopupOpen}\n                                      onUpdateUser={handleUpdateUser}\n                                      onClose={closeAllPopups}/>\n\n                    <AddPlacePopup isOpen={isAddPlacePopupOpen}\n                                   onAddPlaceSubmit={handleAddPlace}\n                                   onClose={closeAllPopups}/>\n\n                    <EditAvatarPopup isOpen={isEditAvatarPopupOpen}\n                                     onUpdateAvatar={handleUpdateAvatar}\n                                     onClose={closeAllPopups}/>\n\n                    <PopupWithForm name=\"delete-image\" title=\"Вы уверены?\" buttonName=\"Да\"/>\n\n                    <ImagePopup\n                        card={selectedCard}\n                        onClose={closeAllPopups}\n                        isOpen={isImagePopupOpen}\n                    />\n                </div>\n            </CurrentUserContext.Provider>\n        </div>\n    );\n}\n\n\nexport default withRouter(App);\n\n"]},"metadata":{},"sourceType":"module"}